### 第一章 数据库和SQL

#### 1-1 数据库是什么

- 数据库是将大量数据保存起来，通过计算机加工而成的可以进行高效访问的数据集合（DB）。

- 用来管理数据库的计算机系统成为数据库管理系统（DBMS）。
  - 根据数据的保存格式，DBMS的种类分为：
    - 层次数据库（HDB）：数据通过层次结构的方式保存。
    - 关系型数据库（RDB）：由行和列组成的二维表管理数据，使用结构化查询语言（SQL）进行数据操作。
    - 面向对象数据库（OODB）：把数据以及对数据的操作集合起来以对象为单位进行管理。
    - XML数据库（XMLDB）：以XML格式存储数据。
    - 键值存储系统（KVS）：单纯用来保存查询所使用的主键和值的组合的数据库。

#### 1-2 数据库的结构

- RDMBS通常使用客户端/服务端的系统结构。
- 通过从客户端向服务端发送SQL语句来实现数据库的读写操作。
- 关系型数据库采用被称为数据库表的二维表来管理数据。
  - 根据SQL语句的内容返回的数据同样必须是二维表的形式。
- 数据库表由表示数据项目的列（字段）和表示一条数据的行（记录）所组成，以行为单位进行数据读写。
- 每个单元格只能输入一个数据。

#### 1-3 SQL概要

- SQL是为操作数据库而开发的语言。

- 虽然SQL也有标准，但实际上根据RDMBS的不同，SQL也不尽相同。

- SQL用关键字、表名和列名等组合而成的一条语句来描述想要的操作。

- 基本书写规则

  - 使用分号结尾。
  - 不区分大小写。
  - 常数的书写方式是固定的。
    - 字符串、日期或数字等称为常数，前两个需要用单引号括起来。
  - 单词之间需要用空格或换行符进行分隔。

- SQL根据操作目的可以分为DDL、DML和DCL。

  - DDL：Data Definition Language，数据定义语言，用来创建或者删除存储数据用的数据库以及数据库中的表等对象。包含

    - create：创建数据库和表等对象
    - drop：删除数据库和表等对象
    - alter：修改数据库和表等对象的结构

  - DML：Data Manipulation Language，数据操纵语言，用来查询或变更表中的记录。包含

    - select：查询表中的数据
    - insert：向表中插入新数据
    - update：更新表中的数据
    - delete：删除表中的数据

  - DCL：Data Control Language，数据控制语言，用来确认或取消对数据库中的数据进行的变更。还可以对RDMBS的用户是否有权限操作数据库中的对象进行设定。包含

    - commit：确认对数据库中的数据进行变更
    - rollback：取消对数据库中的数据进行变更

    - grant：赋予用户操作权限
    - revoke：取消用户操作权限

#### 1-4 表的创建

- 表通过create table语句创建。

  - 创建数据库：`create database <数据库名称>;`

  - 创建表：

    ```
    CREATE TABLE <表名> （<列名1> <数据类型> <该列所需约束>，
     <列名2> <数据类型> <该列所需约束>，
     <列名3> <数据类型> <该列所需约束>，
     <列名4> <数据类型> <该列所需约束>，
     			.
     			.
     			.
     <该表的约束1>， <该表的约束2>，……）；
    ```

- 表和列的命名要使用有意义的文字。

  - 只能使用半角英文字母、数字、下划线（_）作为数据库、表和列的名称  。
  - 名称必须以半角英文字母开头  。
  - 在同一个数据库中不能创建两个相同名称的表，在同一个表中也不能创建两个名称相同的列。

- 指定列的数据类型。

  - INTEGER型，用来指定存储整数的列的数据类型（数字型），不能存储小数。

  - CHAR 是 CHARACTER（字符）的缩写，是用来指定存储字符串的列的数据类型（字符型）。可以像 

    CHAR(10) 或者 CHAR(200) 这样，在括号中指定该列可以存储的字符串的长度（最大长度）。

    字符串以定长字符串  的形式存储在被指定为 CHAR 型的列中。所谓定长字符串，就是当列中存储的字符

    串长度达不到最大长度的时候，使用半角空格进行补足。

  - VARCHAR型，也用来指定存储字符串的列的数据类型（字符串类型），也可以通过括号内的数字来指定

  - 字符串的长度（最大长度）。但该类型的列是以可变长字符串 的形式来保存字符串的。

    可变长字符串即使字符数未达到最大长度，也不会用半角空格补足。

  - DATE型，用来指定存储日期（年月日）的列的数据类型（日期型）。

- 可以在表中设置约束。

  - 约束是除了数据类型之外，对列中存储的数据进行限制或者追加条件的功能。
  - NOT NULL，不能输入空白，也就是必须输入数据的约束。
  - PRIMARY KEY，主键（primary key）就是可以唯一确定一行数据的列。

#### 1-5 表的删除和更新

- 使用DROP TABLE语句来删除表。

  - `DROP TABLE <表名>;`

- 使用ALTER TABLE语句向表中添加列或者从表中删除列。

  - 添加列的ALTER TABLE语句：`ALTER TABLE <表名> ADD COLUMN <列的定义>;`

    列的定义即名称、数据类型、可能的约束。

  - 删除列的ALTER TABLE语句：`ALTER TABLE <表名> DROP COLUMN <列名>;`

- 变更表名

  ```sql
  Oracle PostgreSQL
  ALTER TABLE Poduct RENAME TO Product;
  DB2
  RENAME TABLE Poduct TO Product;
  SQL Server
  sp_rename 'Poduct', 'Product';
  MySQL
  RENAME TABLE Poduct to Product;
  ```

### 第二章 查询基础

#### 2-1 **SELECT**语句基础

- 使用SELECT语句从表中选取数据。

  - 基本的SELECT语句

    ```sql
    SELECT <列名>，……
    FROM <表名>；
    ```

    该 SELECT 语句包含了 SELECT 和 FROM 两个子句（clause）。SELECT 子句中列举了希望从表中查询出

    的列的名称，而 FROM 子句则指定了选取出数据的表的名称。

  - 查询全部的列

    ```sql
    SELECT *
     FROM <表名>;
    ```

    如果使用星号的话，就无法设定列的显示顺序了。这时就会按照 CREATE TABLE 语句的定义对列进行排序。

- 为列设定显示用的别名。

  - 使用 AS 关键字为列设定别名。别名可以使用中文，使用中文时需要用双引号（"）括起来，另外使用双引

    号可以设定包含空格（空白）的别名。

- SELECT语句中可以使用常数或者表达式。

  - ```
    代码清单2-6　查询常数
    SELECT '商品' AS string, 38 AS number, '2009-02-24' AS date,
     product_id, product_name
     FROM Product;
    执行结果
     string | number | date | product_id | product_name
    ---------+-----------+--------------+-------------+--------------
    商品 | 38 | 2009-02-24 | 0001 | T恤衫
    商品 | 38 | 2009-02-24 | 0002 | 打孔器
    商品 | 38 | 2009-02-24 | 0003 | 运动T恤
    商品 | 38 | 2009-02-24 | 0004 | 菜刀
    商品 | 38 | 2009-02-24 | 0005 | 高压锅
    商品 | 38 | 2009-02-24 | 0006 | 叉子
    商品 | 38 | 2009-02-24 | 0007 | 擦菜板
    商品 | 38 | 2009-02-24 | 0008 | 圆珠笔
    ```

    Q：常数有什么使用场合吗？

- 通过指定DISTINCT可以删除重复的行。

  - 想要删除重复行时，可以通过在 SELECT 子句中使用DISTINCT 来实现。

    ```
    SELECT DISTINCT product_type
     FROM Product;
    ```

    在使用 DISTINCT 时，NULL 也被视为一类数据。NULL 存在于多行中时，也会被合并为一条 NULL 数

    据。

    DISTINCT 也可以在多列之前使用。此时，会将多个列的数据进行组合，将重复的数据合并为一条。

    ```
    代码清单2-9　在多列之前使用DISTINCT
    SELECT DISTINCT product_type, regist_date
     FROM Product;
    执行结果
     product_type | regist_date
    --------------+------------
    衣服 | 2009-09-20
    办公用品 | 2009-09-11
    办公用品 | 2009-11-11
    衣服 |	
    厨房用具 | 2009-09-20
    厨房用具 | 2009-01-15
    厨房用具 | 2008-04-28
    ```

    DISTINCT 关键字只能用在第一个列名之前。不能写成 regist_date, DISTINCT product_type。

- SQL语句中可以使用注释。

  - 1行注释，书写在“--”之后，只能写在同一行。 
  - 多行注释，书写在“/\*”和“*/”之间，可以跨多行。

- 可以通过WHERE语句从表中选取出符合查询条件的数据。

  - SELECT语句中的WHERE子句

    ```sql
    SELECT <列名>, ……
     FROM <表名>
     WHERE <条件表达式>;
    ```

    SQL 中子句的书写顺序是固定的，不能随意更改。WHERE 子句必须紧跟在 FROM 子句之后。

#### 2-2 算术运算符和比较运算符

- 运算符就是对其两边的列或者值进行运算（计算或者比较大小等）的符号。

- 使用算术运算符可以进行四则运算。

  - ```
    代码清单2-17　SQL语句中也可以使用运算表达式
    SELECT product_name, sale_price,
     sale_price * 2 AS "sale_price_x2"
     FROM Product;
    执行结果
     product_name | sale_price | sale_price_x2
    ---------------+-------------+----------------
    T恤衫 | 1000 | 2000
    打孔器 | 500 | 1000
    运动T恤 | 4000 | 8000
    菜刀 | 3000 | 6000
    高压锅 | 6800 | 13600
    叉子 | 500 | 1000
    擦菜板 | 880 | 1760
    圆珠笔 | 100 | 200
    ```

- 括号可以提升运算的优先顺序（优先进行运算）。

- 包含NULL的运算，其结果也是NULL。 

- 比较运算符可以用来判断列或者值是否相等，还可以用来比较大小。

  - “不等于”比较运算符：<>。

    - 有很多 RDBMS可以使用比较运算符“!=”来实现不等于功能。但这是限于不被标准SQL所承认的特定 

      SQL，出于安全的考虑 ,最好不要使用。

  - 字符串类型的数据按照字典顺序进行排序。

- 判断是否为NULL，需要使用IS NULL或者IS NOT NULL运算符。

#### 2-3 逻辑运算符

- 通过使用逻辑运算符，可以将多个查询条件进行组合。

- 通过NOT运算符可以生成“不是~”这样的查询条件。

  - NOT 不能单独使用，必须和其他查询条件组合起来使用。

      ```sql
        SELECT product_name, product_type, sale_price
         FROM Product
         WHERE NOT sale_price >= 1000;
      ```

- 两边条件都成立时，使用AND运算符的查询条件才成立。

- 只要两边的条件中有一个成立，使用OR运算符的查询条件就可以成立。

- 值可以归结为真（TRUE）和假（FALSE）其中之一的值称为真值。比较运算符在比较成立时返回真，不成立

  时返回假。但是，在 SQL中还存在另外一个特定的真值——不确定（UNKNOWN）。

- 将根据逻辑运算符对真值进行的操作及其结果汇总成的表称为真值表。

- SQL中的逻辑运算是包含对真、假和不确定进行运算的三值逻辑。